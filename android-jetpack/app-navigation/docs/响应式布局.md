# 响应式布局

本文整理 Android 中实现**响应式布局**（根据屏幕尺寸切换界面结构）的通用知识点。官方参考：[为不同屏幕尺寸设计应用](https://developer.android.google.cn/guide/topics/large-screens/support-different-screen-sizes)、[处理配置变更](https://developer.android.google.cn/guide/topics/resources/runtime-changes)。

---

## 一、目标与核心思路

**目标**：同一应用在不同设备（手机、平板、折叠屏等）上提供合适的布局——小屏紧凑、大屏充分利用空间，导航与内容排布随宽度变化。

**核心思路**：

1. **资源限定符**：用 `layout-w600dp`、`values-w600dp` 等为不同“宽度”提供不同布局或数值，系统根据当前设备**最小宽度**自动选用。
2. **同一 ID、不同布局**：不同配置下根节点或子视图可以不同，但关键 View 的 **id 保持一致**；代码通过 `findViewById` / View Binding 获取，不存在的视图为 `null`，用**判空**区分行为。
3. **单一逻辑、多套 UI**：导航图或业务逻辑统一，仅根据“当前加载的布局”中哪些 View 存在，绑定不同 UI（如小屏底部导航、大屏抽屉），实现一套代码适配多尺寸。

---

## 二、资源限定符

### 2.1 按宽度选择资源

根据**最小宽度**（设备竖屏时的宽度）选择资源，与横竖屏无关，适合做“手机 vs 平板”的断点。

| 限定符 | 含义 | 常见用途 |
|--------|------|----------|
| **默认（无限定符）** | 所有未匹配更具体限定符的情况 | 手机、小屏默认布局 |
| **w<N>dp** | 最小宽度 ≥ N dp | 平板、大屏布局 |
| **sw<N>dp** | 最小边（宽高取小）≥ N dp | 与 w 类似，更稳定 |

**示例目录**：

- `res/layout/`、`res/values/`：默认（手机）
- `res/layout-w600dp/`、`res/values-w600dp/`：最小宽度 ≥ 600dp 时使用
- `res/layout-w840dp/`：更大平板或折叠屏展开

### 2.2 选择规则

系统根据当前设备的**最小宽度**与资源目录中的数值比较，选用**最匹配且不超过当前宽度**的那一组；若无匹配，则回退到默认（无限定符）资源。

---

## 三、多布局策略：保持 ID 一致

要让同一份 Activity/Fragment 代码在不同布局下都能运行：

- **关键 View 的 `android:id` 在各配置下保持一致**（如导航容器、内容区、底部导航、侧栏的 id）。
- 小屏布局可以**不包含**某些 View（如无侧栏），大屏布局可以**不包含**另一些 View（如无底部导航）。代码里对可能为 `null` 的 View **判空**后再使用。

**写法示例**：

```java
// 使用 View Binding 时，未出现在当前布局中的视图为 null
if (binding.navView != null) {
    // 当前为“有侧栏/抽屉”的布局
    NavigationUI.setupWithNavController(binding.navView, navController);
}
if (binding.bottomNavView != null) {
    // 当前为“有底部导航”的布局
    NavigationUI.setupWithNavController(binding.bottomNavView, navController);
}
```

**注意**：若同一 id 在不同配置下对应不同 View 类型，可用**同一类型的容器**包裹（如外层统一用 `FrameLayout`），让 id 落在该容器上，避免类型强转异常。

---

## 四、导航模式随宽度变化

| 屏幕类型 | 典型做法 |
|----------|----------|
| **小屏（手机）** | 底部导航栏（BottomNavigationView）、或 Toolbar + 溢出菜单；侧栏可省略或收在抽屉里。 |
| **中大屏（平板）** | 抽屉导航（DrawerLayout + NavigationView），侧栏滑出；同一 NavController 绑定到 NavigationView。 |
| **大屏（平板/折叠展开）** | 常驻侧栏：侧栏与内容区并排，无需抽屉；同一 NavController 绑定到侧栏。 |

实现要点：

- **同一 NavController / NavGraph**：无论用底部导航还是侧栏，都绑定到同一个 `NavController`，保证导航目标和返回栈一致。
- **AppBarConfiguration**：有抽屉时用 `setOpenableLayout(drawerLayout)`；无抽屉时可不设置或传 `null`。
- **溢出菜单**：小屏无侧栏时，可在 `onCreateOptionsMenu` 中根据“侧栏是否存在”决定是否 inflate 溢出菜单，避免大屏上重复入口。

---

## 五、内容区布局随宽度变化

### 5.1 同一 Fragment、不同布局

同一 Fragment 类可对应多套布局（通过资源限定符）：

- 默认：单列列表（`RecyclerView` + `LinearLayoutManager`）。
- `layout-w600dp`：多列网格（`GridLayoutManager`、`spanCount` 等）。

Fragment 内只按 id 查找 View、使用适配器，无需在代码里判断屏幕宽度；系统根据当前配置自动加载对应布局。

### 5.2 尺寸资源（dimens）

用 **values** 限定符为不同宽度提供不同数值：

- `values/dimens.xml`：小屏边距、图标大小等。
- `values-w600dp/dimens.xml`：大屏下更大的边距和控件尺寸。

布局中引用 `@dimen/xxx`，系统会自动选用当前配置下的值，避免在代码里写死或手写宽度判断。

---

## 六、常用宽度断点（参考）

| 最小宽度 | 典型设备 | 常见做法 |
|----------|----------|----------|
| &lt; 600dp | 手机 | 单列、底部导航、紧凑间距 |
| 600dp–839dp | 7 寸平板、折叠半开 | 抽屉、双列、增大间距 |
| 840dp+ | 10 寸平板、折叠全开 | 常驻侧栏、多列、主从布局 |

断点可按设计需求调整；资源目录的限定符（如 `w600dp`）与所选断点保持一致即可。

---

## 七、小结

- 用 **资源限定符**（`layout-w600dp`、`values-w600dp` 等）按“最小宽度”提供多套布局和尺寸。
- 多套布局中**关键 View 的 id 保持一致**，代码通过**判空**区分“当前是哪种布局”。
- 导航用**同一 NavController** 绑定不同 UI（底部导航 / 抽屉 / 常驻侧栏），逻辑统一。
- 内容区通过**不同布局文件**（列表 vs 网格）和 **dimens** 按宽度适配，无需在业务代码里写屏幕宽度判断。

按上述方式组织资源和代码，即可用一套代码、多套布局实现响应式界面。
