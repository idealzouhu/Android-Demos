## 一、默认菜单系统

### 选项菜单 OptionsMenu

OptionsMenu 是 Android 应用的标准菜单系统，是菜单功能的**总称和基础**。

**特点**：

- 系统级别的菜单管理
- 通过 `onCreateOptionsMenu()`创建
- 通过 `onOptionsItemSelected()`处理点击
- 是溢出菜单的**数据来源**





### 溢出菜单 — 显示方式

溢出菜单  是 OptionsMenu 在**屏幕空间不足时**的显示方式。

其工作原理为：

```mermaid
graph LR
    A[OptionsMenu创建] --> B{屏幕空间是否足够?}
    B -->|空间足够| C[所有菜单项显示在ActionBar]
    B -->|空间不足| D[重要项显示在ActionBar<br>次要项进入溢出菜单]
    D --> E[用户点击三个点图标]
    E --> F[显示溢出菜单列表]
```

## 工作流程

```mermaid
graph TD
    A[Activity创建] --> B[系统调用onCreateOptionsMenu]
    B --> C[加载menu.xml资源]
    C --> D[系统自动决定显示方式]
    D --> E{屏幕空间足够?}
    E -->|是| F[直接显示在ActionBar]
    E -->|否| G[重要项显示在ActionBar<br>次要项进入溢出菜单]
    F --> H[用户点击菜单项]
    G --> I[用户点击三个点图标]
    I --> J[显示溢出菜单]
    J --> H
    H --> K[系统调用onOptionsItemSelected]
```





## 二、自定义菜单

### 弹出菜单 PopupMenu - 独立个体

PopupMenu 是一个独立的 UI 组件，可以**在任何地方创建弹出菜单**。



### 工作流程

```mermaid
graph TD
    A[用户点击某个View] --> B[手动创建PopupMenu实例]
    B --> C[手动加载菜单资源]
    C --> D[手动调用show方法]
    D --> E[弹出独立菜单窗口]
    E --> F[用户点击菜单项]
    F --> G[手动处理点击事件]
```

例如，

```java
    private void setupClickListeners() {
        // 菜单按钮点击事件
        btnMenu.setOnClickListener(this::showPopupMenu);
    }

    /**
     * 显示弹出菜单（替代选项菜单）
     */
    private void showPopupMenu(View view) {
        PopupMenu popupMenu = new PopupMenu(this, view);
        popupMenu.getMenuInflater().inflate(R.menu.main_menu, popupMenu.getMenu());

        popupMenu.setOnMenuItemClickListener(new PopupMenu.OnMenuItemClickListener() {
            @Override
            public boolean onMenuItemClick(MenuItem item) {
                return onOptionsItemSelected(item);
            }
        });

        popupMenu.show();
    }
```







## 总结

| 特性         | OptionsMenu             | 溢出菜单                  | PopupMenu          |
| :----------- | :---------------------- | :------------------------ | :----------------- |
| **本质**     | 菜单系统**总称**        | OptionsMenu的**显示模式** | 独立**UI组件**     |
| **创建方式** | `onCreateOptionsMenu()` | 系统自动处理              | `new PopupMenu()`  |
| **显示控制** | 系统管理                | `showAsAction`属性        | 手动`show()`       |
| **位置**     | 固定在ActionBar         | ActionBar右侧三个点       | 任意View关联       |
| **数据源**   | 菜单资源文件            | 来自OptionsMenu           | 菜单资源或动态添加 |